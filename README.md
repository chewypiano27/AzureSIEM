# AzureSIEM
Real-Time Threat Detection & Analysis using a Honeypot and Security Information and Events Management (SIEM) Platform; Azure & Sentinel

<p align="center">
  <img src="https://github.com/user-attachments/assets/eaad7f8f-a490-4255-b0c6-b193b66e0934" width="800">
  <img src="https://github.com/user-attachments/assets/9e06de68-d942-4c0b-8048-f0cb364ea90b" width="800">
</p>

## Executive Summary
This project designed and implemented a home Security Operations Center (SOC) in Microsoft Azure to detect and analyze real-world brute-force attacks. A honeypot VM, intentionally exposed to the public internet, attracted almost 34,000 brute-force attempts over a 163-hour testing period. Log analysis and visualization within Microsoft Sentinel, using Kusto Query Language (KQL), provided real-time insights into attack sources and patterns. The project demonstrated practical skills in log analysis, threat detection, and SOC operations in a cloud environment, aligning with industry best practices such as NIST 800-61 & NIST 800-53. Key findings revealed a significant reduction in attack traffic after implementing stricter Network Security Group (NSG) rules, highlighting the effectiveness of layered security. The project also explored automated incident response and future enhancements involving AI and internal honeypot traps to further strengthen threat detection capabilities. 

 
High-level overview: 

●	Setting up an insecure VM 

●	Configuring Log Analytics Workspace 

●	Forwarding logs and integrating with Sentinel 

●	Querying failed login attempts and visualising attack sources 

●	Visualising an attack heatmap to track real-time hacker activity 

 
__Key Skills: log analysis, threat detection, and SOC operations in a real-world cloud environment.__

**Key Components and Technologies:**

●	Honeypot (Azure VM) 
  
  A deliberately vulnerable virtual machine acts as a decoy to attract and trap attackers attempting brute-force logins. Its public IP address is exposed to the internet. 
  
●	Network Security Group (NSG) 
  
  While the honeypot is intentionally exposed, an NSG is still used for initial traffic filtering and can be configured to block known malicious IP addresses or restrict access to specific ports if needed. This provides a basic layer of defense while allowing the honeypot to fulfill its purpose. 
  
●	Log Analytics Workspace 
  
  Serves as a central repository for logs generated by the honeypot VM. The Azure Monitoring Agent installed on the VM forwards security logs, including failed login attempts (Event ID 4625), to the workspace.
  
●	Microsoft Sentinel (SIEM) 
  
  Integrates with the Log Analytics Workspace to provide advanced threat detection and analysis capabilities. KQL queries are used to filter, analyse, and visualise attack data. Sentinel's built-in dashboards and workbooks enable real-time monitoring and reporting. 

●	GeoIP Lookup (Sentinel Watchlist) 
  
  Enriches security logs with geolocation data, providing insights into the geographic origin of attacks. This data is crucial for identifying attack patterns and potential threat actors. 

●	Kusto Query Language (KQL) 
  
  The powerful query language used within Sentinel to extract, transform, and analyse log data. Custom KQL queries are developed to identify brute-force attempts, correlate events, and generate visualisations. 

●	Attack Heatmap (Sentinel Workbook) 
  
  A custom workbook within Sentinel displays a real-time heatmap of attack sources, providing a visual representation of global attack activity against the honeypot. 

## Threat Analysis & Research

### Problem Statement 
The increasing reliance on internet-facing systems across all industries expands the attack surface for malicious actors. Brute-force attacks, exploiting weak or default credentials, remain a prevalent threat, particularly targeting the Remote Desktop Protocol (RDP) commonly used for remote administration. The healthcare sector, with its growing dependence on interconnected systems and remote access for patient care, is a prime target. Ransomware, often delivered through brute-force attacks, poses a critical threat, potentially disrupting operations, compromising patient data, and leading to significant financial and reputational damage. This vulnerability is classified as T1110 - Brute Force within the MITRE ATT&CK framework. 

### Threat Impact 
The SamSam ransomware campaign (2015-2018) serves as a stark example of the devastating impact of brute-force attacks combined with ransomware deployment. This Advanced Persistent Threat (APT), attributed to Iranian hackers, had targeted hospitals, municipalities, and businesses, successfully infiltrating networks through RDP brute-force attacks. The City of Atlanta (in 2018), Hancock Health Hospital, and the Colorado Department of Transportation, among others, fell victim to SamSam, experiencing significant disruptions to critical services. As a consequence, this resulted in these organisations incurring substantial recovery costs. In the healthcare context, such attacks can jeopardise patient safety by delaying or denying access to essential medical records and systems. The financial ramifications include ransom payments, system restoration expenses, legal fees, and reputational damage. Beyond direct financial costs, these attacks erode public trust and can have long-lasting consequences for the affected organisations. 


### Current Security & Compliance Gaps 
Traditional security measures often fall short in effectively mitigating brute-force attacks. Basic password policies, while necessary, are often insufficient to deter determined attackers. Many organisations lack multi-factor authentication (MFA), leaving accounts vulnerable even with strong passwords. Network-level protections, such as firewalls, can be bypassed if RDP ports are exposed to the internet. Furthermore, many organisations lack real-time threat detection capabilities. Log analysis is often performed retroactively, leaving a window of opportunity for attackers to establish a foothold and deploy malware. The lack of automated incident response mechanisms further exacerbates the problem, delaying containment and remediation efforts. Compliance gaps, particularly in adhering to frameworks like NIST Cybersecurity Framework and HIPAA in the healthcare sector, contribute to vulnerabilities and increase the risk of successful attacks. 


## Security Solution Design 

### Proposed solution 
This project implements a multi-layered security solution centered around a honeypot deployed in Microsoft Azure, integrated with a Security Information and Event 
Management (SIEM) system for real-time threat detection and analysis. 

## Project Architecture

<p align="center">
  <img src="https://github.com/user-attachments/assets/eaad7f8f-a490-4255-b0c6-b193b66e0934">
</p>

### Workflow

●	Public Internet 

Represents the external network where potential attackers reside. These attackers attempt to access resources within the Azure environment. 

●	Network Security Group (NSG) 

Acts as a firewall to filter network traffic to and from Azure resources. It blocks unauthorised access attempts from the public internet, providing a layer of security. 

●	Azure Subscription 

The overarching container for all Azure resources, including the virtual network and other components. 

●	Resource Group 

A logical container within the Azure subscription that holds related resources for an Azure solution. 

●	Virtual Network (VNet) 

Provides an isolated network environment within Azure, allowing resources to securely communicate with each other. 

●	Virtual Machine (VM) 

Represents a compute resource within the VNet that can run applications and services. It is protected by the NSG. 

●	Log Analytics Workspace 

Collects and analyses data from various sources, including the VM, to provide insights into the environment's security posture. 

●	Microsoft Sentinel (SIEM) 

A cloud-native security information and event management (SIEM) system that aggregates data from the Log Analytics Workspace. It provides advanced threat detection and response capabilities. 

●	Security Operations Center (SOC) 

The centralised unit that monitors, detects, and responds to security incidents using the tools and data provided by Microsoft Sentinel and other Azure services. 
 
## Configuration

### 1. Honeypot Deployment: 

●	I created a Resource Group in Azure to organise project resources. 

●	Deployed a Windows Server VM within the Resource Group. (Specify VM size and OS version). Named the VM "BANKING-PC" to entice potential attackers. 

●	Configured the VM's networking to allow public IP connectivity. This exposes the honeypot to potential attacks. 

●	Disabled the Windows Firewall within the VM to maximise the attack surface and capture a wider range of attack attempts. 

### 2. Log Analytics Workspace Setup: 

●	I created a Log Analytics Workspace within the same Resource Group. 

●	Enabled the "Windows Security Events" data connector in the workspace to collect relevant security logs. 

### 3. Sentinel Integration: 

● I enabled Microsoft Sentinel and connected it to the Log Analytics Workspace. 

This allows Sentinel to access and analyse the collected logs. 

### 4. Data Collection Rule: 

●	I created a data collection rule to configure the VM to forward its security logs to the Log Analytics Workspace; ensuring continuous log streaming to Sentinel. 

●	Confirmed successful installation and operation of the Azure Monitoring Agent on the VM. 

### 5. KQL Querying and Validation: 

● Used KQL queries within Sentinel to validate log ingestion and analyse failed login attempts (Event ID 4625). 

Initial KQL Query: 

    SecurityEvent 
    | where EventID == 4625 

This outputs only the security events that were unsuccessful login attempts. 

### 6. GeoIP Enrichment: 

● Imported a GeoIP database (CSV format) into a Sentinel watchlist; enabling geolocation of attacker IP addresses. 

### 7. Advanced KQL Querying and Visualisation: 

● Developed a more advanced KQL query to enrich failed login events with geolocation 

Advanced KQL query: 

    let GeoIPDB_FULL = _GetWatchlist("geoip"); let WindowsEvents = SecurityEvent     
    | where EventID == 4625 
        | order by TimeGenerated desc 
        | evaluate ipv4_lookup(GeoIPDB_FULL, IpAddress, network); 
    WindowsEvents 
    | project TimeGenerated, Computer, AttackerIP = IpAddress, cityname, countryname, latitude, longitude 

The aforementioned KQL query retrieves failed login attempts (Event ID 4625) from the SecurityEvent table, sorts them by TimeGenerated, and enriches them with geolocation data from a watchlist named GeoIPDB_FULL. An IPv4 lookup is performed, to match each attacker's IP address with geographic details like city, country, latitude, and longitude. It outputs the most pertinent information; the timestamp, computer name, attacker’s IP, and geolocation information. 

### 8. Attack Heatmap Creation: 

● Created a custom Sentinel workbook and added the advanced KQL query to generate a real-time attack heatmap. 

KQL script in advanced editor 

    { 
    	 	"type": 3, 
    	 	"content": { 
    	 	"version": "KqlItem/1.0", 
    	 	"query": "let GeoIPDB_FULL = _GetWatchlist(\"geoip\");\nlet WindowsEvents = 
    SecurityEvent;\nWindowsEvents | where EventID == 4625\n| order by TimeGenerated desc\n| evaluate ipv4_lookup(GeoIPDB_FULL, IpAddress, network)\n| summarize FailureCount = count() by IpAddress, latitude, longitude, cityname, countryname\n| project FailureCount, AttackerIp = IpAddress, latitude, longitude, city = cityname, country = countryname,\nfriendly_location = strcat(cityname, \" (\", countryname, \")\");", 
    	 	"size": 3, 
    	 	"timeContext": { 
    	 	 	"durationMs": 2592000000 
    	 	}, 
    	 	"queryType": 0, 
    	 	"resourceType": "microsoft.operationalinsights/workspaces", 
    	 	"visualization": "map", 
    	 	"mapSettings": { 
    	 	 	"locInfo": "LatLong", 
    	 	 	"locInfoColumn": "countryname", 
    	 	 	"latitude": "latitude", 
    	 	 	"longitude": "longitude", 
    	 	 	"sizeSettings": "FailureCount", 
    	 	 	"sizeAggregation": "Sum", 
    	 	 	"opacity": 0.8, 
    	 	 	"labelSettings": "friendly_location", 
    	 	 	"legendMetric": "FailureCount", 
    	 	 	"legendAggregation": "Sum", 
    	 	 	"itemColorSettings": { 
    	 	 	"nodeColorField": "FailureCount", 
    	 	 	"colorAggregation": "Sum", 
     	 	"type": "heatmap",  	 	"heatmapPalette": "greenRed" 
    	 	 	} 
    	 	} 
    	 	}, 
    	 	"name": "query - 0" 
 
### 9. Automated Incident Response 

● I created a new Scheduled Query Rule in Sentinel named "Brute-Force Attempt Detection." 

    SecurityEvent 
    | where EventID == 4625  // Failed login attempts 
    | summarize FailedCount = count() by Account, bin(TimeGenerated, 5m) 
    | where FailedCount > 5 

This query identifies potential brute-force attacks by counting failed logins within 5-minute windows, triggering an alert when the count exceeds 5. The rule runs every 5 minutes for near real-time detection. Moreover, I configured the rule to automatically create incidents from these alerts with a "High" severity for prioritised investigation. 

### 10. Playbook Creation and Configuration 

I created a new Playbook in Sentinel’s Automation section using Azure Logic Apps. I then defined the following actions: 

- Get Incident Details: This action retrieves essential information about the triggered incident, including the attacker's source IP address. 

- Simulate IP Blocking: Due to the limitations of the free Azure trial, direct automated blocking was not possible. Therefore, I implemented a simulated blocking action. This action logs the IP address that would have been blocked in a production environment, demonstrating the intended workflow. In a real-world scenario, this step would integrate with Azure Firewall or Network Security Groups to dynamically block the malicious IP. 

- Notification: The Playbook sends an email notification to a designated security email address with the subject "Alert: Multiple Failed Logins Detected." The email body includes details about the triggered alert, such as the affected account, and the source IP address. 

- Incident Update: The Playbook updates the Sentinel incident with information about the automated response, including the simulated blocking action; creating a comprehensive audit trail of the actions taken. 

## Testing Methodology

The honeypot VM was left running and exposed to the internet for an extended period (approximately 163 hours) to collect a substantial dataset of real-world attack attempts. 

This passive approach allowed for the observation of organic attack patterns without simulating specific attacks. The increasing density of data points on the attack heatmap over time provided clear evidence of ongoing brute-force attempts against the honeypot. 

## Screenshots

<p align="center">
  <img src="https://github.com/user-attachments/assets/3fe6c64b-aa90-415e-a2d5-1d915d6cd09e" width="800">
</p>
<p align="center">
  After ~39 hours
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/44082a48-e1a9-4bc2-b1db-ebe317e7a611" width="800">
</p>
<p align="center">
  After ~63 hours
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/c42fa710-6fba-4c13-9ebc-d1c853247050" width="800">
</p>
<p align="center">
  After ~70 hours
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/930c9361-9d42-4af7-9d91-4e3ad49eb478" width="800">
</p>
<p align="center">
  After ~86 hours
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/9be216da-1e5b-421f-af22-acca7eb77eea" width="800">
</p>
<p align="center">
  After ~92 hours
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/c6f3b250-6139-4e71-87d0-46483e83f005" width="800">
</p>
<p align="center">
  After ~109 hours
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/e823dd16-e9f8-499a-a966-8aec07d5e1d0" width="800">
</p>
<p align="center">
  After ~118 hours
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/75df7780-6c03-4e36-ace7-202d5bc83bdb" width="800">
</p>
<p align="center">
  After ~138 hours
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/af56ceab-e541-472f-b107-686e2ab39aad" width="800">
</p>
<p align="center">
  After ~150 hours
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/ebab750b-f398-407b-ba71-d5eb5e574c9c" width="800">
</p>
<p align="center">
  After ~163 hours
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/e2360d10-6897-45fa-a028-59026b3a5d7b" width="400">
</p>
<p align="center">
  This is how the logs appear inside the insecure VM within Windows Event Viewer. The logs are filtered by Event ID 4625 (Unsuccessful log on). There were over 32,400 RDP login attempts to the VM (at the time of screenshot 8PM 17/03/2025), as highlighted in the above image.
</p>

## Ethical and Legal Considerations

### Ethical Reflection

The deployment of a honeypot requires careful consideration of ethical boundaries. While the intention is to attract and analyse malicious activity, it's crucial to ensure that the honeypot does not become a source of attacks against other systems. In this project, the honeypot was configured to only log and analyse incoming connection attempts. No outgoing connections were initiated, and no data was exfiltrated or manipulated. This passive approach minimises the risk of the honeypot being used for malicious purposes. Furthermore, the project adhered to responsible disclosure principles. Any identified vulnerabilities in third-party systems would be reported through appropriate channels rather than exploited. The focus remained on defensive security practices and responsible data handling. 

### Compliance Frameworks

This project aligns with the NIST 800-61 incident management lifecycle, incorporating elements of preparation, detection and analysis, containment, eradication, and recovery. 

<p align="center">
  <img src="https://github.com/user-attachments/assets/da24d57c-b556-4d03-9dbb-588d7f48e9b9" width="800">
</p>

The preparation phase involved configuring log ingestion and alert rules within Azure 
Sentinel.  
The detection and analysis phase focused on triaging and investigating incidents, classifying the observed brute-force attempts as "benign positives" due to the lack of successful logins or system compromise.  
While no containment or eradication actions were required for these benign incidents, the project demonstrated the planned response workflow, including simulated IP blocking and security notifications.  
The recovery phase, although not strictly necessary for the benign incidents, involved strengthening the overall security posture by restricting network access to VMs, implementing recommendations from Microsoft Defender for Cloud (MDC), enabling regulatory compliance frameworks within MDC (including NIST 800-53), and securing 
Azure Key Vault and Storage Account instances using private endpoints and firewalls. 
 
I must emphasise - it is important to handle log data responsibly, especially when it comes to personal information. In a corporate setting, this data would be subject to privacy regulations like GDPR, so minimising the data collected and keeping it secure is key. I've tried to follow these best practices here. Also, by using security controls based on the NIST 800-53 standard, I've aimed for a strong security setup, showing how important ethical and compliant practices are in every part of system design and operation. 

## Results

### Effectiveness Metrics

The honeypot attracted a significant volume of brute-force attempts over the 163-hour testing period. The implemented KQL queries effectively identified and categorised these attempts, providing valuable insights into attacker behavior and geographic distribution. While the initial configuration allowed unrestricted access to the honeypot, after observing initial attack patterns, I implemented more restrictive Network Security Group (NSG) rules. Specifically, I limited inbound RDP access to only a few trusted IP addresses. This change resulted in a demonstrable reduction in attack traffic. The logs showed a 100% decrease in failed RDP login attempts after the NSG rules were implemented, which was also reflected in a less dense attack heatmap visualisation. Obviously, a 100% detection rate for the targeted brute-force attacks within the defined scope was achieved. 

<p align="center">
  <img src="https://github.com/user-attachments/assets/001aa651-01c8-40eb-89ab-3fec0544e845" width="800">
</p>
<p align="center">
  The heatmap where the VM was insecure and vulnerable to RDP connection attempts. Number of logs: 33,958
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/b063fa85-4634-4c09-b04f-40f43a7cc786" width="800">
</p>
<p align="center">
  The heatmap after implementing security solutions to the VM. Number of logs: 0
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/7ed0083b-3c24-4e08-9616-793a6cbac74b" width="400">
</p>
<p align="center">
  SIEM log detection pie chart
</p>

## Limitations

The scope was limited to detecting and analysing brute-force login attempts against a single Windows VM. Other attack vectors, such as malware delivery, phishing, or denial-of-service attacks, were not captured. Additionally, the simulated nature of the automated response, due to resource constraints of the free Azure trial, prevented the full implementation and testing of automated blocking and mitigation actions. The reliance on a single honeypot also limits the visibility into attack patterns targeting other operating systems or services. 

## Future Implementation & Improvements

I have three recommendations on how this project can be improved, within the scope of the project guidelines. 

### Post-compromise intrusion analysis

To gain deeper insights into attacker behavior, the honeypot can be enhanced with internal traps to monitor post-compromise activity.  This involves planting fake credentials, simulated sensitive data, and instrumented applications within the VM. Network monitoring tools can capture internal traffic.  This setup allows for analysis of malware samples, attacker TTPs (Tactics, Techniques, and Procedures), objectives (e.g. financial gain), and command-and-control infrastructure.  This intelligence enables us to both strengthen defenses & improve incident response, 

### Artificial Intelligence and Machine Learning

Integrating AI and machine learning within Sentinel enhances threat detection by identifying subtle attack patterns. Some attack patterns are not immediately obvious to human observers, yet, artificial intelligence uses millions of datapoints to detect trends before humans can. Anomaly detection establishes baselines of normal activity and triggers alerts on deviations, enabling proactive threat identification.  

### Mutli-honeypot deployment
A diverse, multi-honeypot deployment provides a broader view of the threat landscape. Variations in OS capture platform-specific attacks. Expanding services (web, database, mail) attract diverse attacks and reveal service vulnerabilities. Carefully managed high-interaction honeypots enable deeper attacker engagement and malware capture.  


## References & Documentation

Microsoft. (2025a). Azure documentation. Azure.cn. 
https://docs.azure.cn/en-us/?product=popular 

Microsoft. (2025b). Kusto documentation - Kusto. Microsoft.com. 
https://learn.microsoft.com/en-us/kusto/?view=microsoft-fabric 

NIST. (2020a, January 12). NIST SP 800-61. NIST. 
https://www.nist.gov/privacy-framework/nist-sp-800-61 

NIST. (2020b, September). Security and Privacy Controls for Information Systems and Organizations. Csrc.nist.gov. 
https://csrc.nist.gov/pubs/sp/800/53/r5/upd1/final 

United States Government. (2018, December 3). SamSam Ransomware | CISA. 
Www.cisa.gov. https://www.cisa.gov/news-events/cybersecurity-advisories/aa18-337a 

Wikipedia Contributors. (2019, October 10). Remote Desktop Protocol. Wikipedia; 
Wikimedia Foundation. https://en.wikipedia.org/wiki/Remote_Desktop_Protocol 
